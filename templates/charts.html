{% extends "layout.html" %}
{% block title %}Charts{% endblock %}

{% block body %}


<h2>Charts</h2>


<div class="container mt-4">
    <div class="row">

        <div class="col-md-6">
            <canvas id="expenseDonut" style="width: 500px; height: 500px; margin-left:50px;"></canvas>
            <p style="margin-left:50px;">(fig: Doughnut Chart illustrating expense split among categories)</p>
        </div>
        <div class="col-md-6">
            <canvas id="last7Bar"></canvas>
        </div>
        <p style="margin-left:850px">(fig: Bar Chart illustrating expense of last 7 days)</p>
    </div>
</div>

<div class="col-12 mt-4">
    <div class="card p-3 shadow-sm">
        <canvas id="monthlyLine" style="height:280px;"></canvas>
    </div>
    <p style="margin-left:500px;">(fig: Line graph showing day-by-day expenses for the current month)</p>
</div>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  // labels_js and values_js must be passed from Flask as strings, e.g. labels_js = "['Food','Travel']"
  const labels = {{ labels_donut_js | safe }};
  const values = {{ values_donut_js | safe }};

  new Chart(
    document.getElementById("expenseDonut"),
    {
      type: "doughnut",
      data: {
        labels: labels,
        datasets: [{
          data: values,
          // Optional: add a thin border
          borderWidth: 1
        }]
      },
      options: {
        responsive: false,       // Chart.js will respect the canvas CSS size
        cutout: "60%",           // donut thickness
        plugins: {
          legend: { position: "right" }
        }
      }
    }
  );
</script>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    // Data from Flask
    const labels7 = {{ labels_7_js | safe }};
    let values7 = {{ values_7_js | safe }};
    values7 = values7.map(v => Number(v) || 0);   // ensure numeric

    // Create bar chart
    new Chart(document.getElementById("last7Bar"), {
        type: "bar",
        data: {
            labels: labels7,
            datasets: [{
                label: "Expense (₹)",
                data: values7,
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    title: { display: true, text: "Amount" }
                },
                x: {
                    title: { display: true, text: "Date" }
                }
            },
            plugins: {
                legend: { display: false }
            }
        }
    });
</script>


<script>
const labelsLine = {{ labels_line_js | safe }};
let valuesLine = {{ values_line_js | safe }};
valuesLine = valuesLine.map(v => Number(v) || 0);

new Chart(document.getElementById("monthlyLine"), {
    type: "line",
    data: {
        labels: labelsLine,
        datasets: [{
            label: "Expense (₹)",
            data: valuesLine,
            fill: false,
            borderWidth: 2,
            tension: 0.3    // smooth curve
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
            y: { beginAtZero: true },
            x: { title: { display: true, text: "Day of Month" } }
        }
    }
});
</script>


{% endblock %}
